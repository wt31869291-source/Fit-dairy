<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥åº·æ—¥è¨˜</title>
    <style>
        :root { --bg: #fdfcf8; --text: #4a4a4a; --green: #a3b18a; --blue: #9eb3c2; --pink: #eac4d5; --orange: #e6a27e; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }
        .page { display: none; padding: 15px; }
        .active { display: block; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        
        /* æœˆæ›†è‡ªå®šç¾©ç¬¦è™Ÿ */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .day { aspect-ratio: 1; border: 1px solid #f0f0f0; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; cursor: pointer; position: relative; }
        .day.selected { border: 2px solid var(--blue); background: #f9f9f9; }
        .status-dots { position: absolute; bottom: 2px; display: flex; gap: 2px; }
        .dot { width: 4px; height: 4px; border-radius: 50%; }
        
        /* è¼¸å…¥æ§åˆ¶ */
        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.85rem; margin-bottom: 4px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        
        /* åº•éƒ¨å°è¦½ */
        .nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; }
        .nav-item { text-decoration: none; font-size: 1.4rem; color: #aaa; text-align: center; }
        .nav-item.active { color: var(--blue); }
        .nav-item span { display: block; font-size: 0.65rem; }
    </style>
</head>
<body>

    <div id="home" class="page active">
        <div class="card">
            <h2 id="home-date">å¥åº·æ—¥è¨˜</h2>
            <div id="coach-msg" style="font-size: 0.9rem; color: var(--orange); border-left: 4px solid var(--green); padding-left: 10px;">
                è¼¸å…¥å€‹äººè³‡æ–™ä¾†é–‹å•Ÿç²¾æº–å»ºè­°ï¼
            </div>
        </div>
        <div class="card" style="text-align: center;">
            <div style="font-size: 0.9rem; color: #888;">ä»Šæ—¥å‰©é¤˜ç†±é‡</div>
            <div style="font-size: 2.5rem; font-weight: bold; color: var(--green);" id="rem-kcal">--</div>
            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                <span>æ”å–: <b id="h-eat">0</b></span>
                <span>æ¶ˆè€—: <b id="h-burn">0</b></span>
                <span>æ°´: <b id="h-water">0</b></span>
            </div>
        </div>
    </div>

    <div id="record" class="page">
        <div class="card"><div class="calendar-grid" id="cal"></div></div>
        <div id="edit-zone" class="card" style="display:none;">
            <h3 id="ed-title">é¸æ“‡æ—¥æœŸ</h3>
            <label><input type="checkbox" id="is-period"> ğŸŒ¸ ä»Šå¤©æ˜¯ç”Ÿç†æœŸ</label>
            <hr>
            <div class="input-group">
                <label>å¿«é€ŸåŠ å…¥é£Ÿç‰©</label>
                <select onchange="addFood(this.value)">
                    <option value="0">é¸æ“‡é£Ÿç‰©...</option>
                    <option value="600">æ’éª¨éºµ (600å¡)</option>
                    <option value="150">ç‚’é’èœ (150å¡)</option>
                    <option value="350">è è˜¿éºµåŒ… (350å¡)</option>
                </select>
                <input type="number" id="in-food" placeholder="æ‰‹å‹•è¼¸å…¥ç¸½ç†±é‡">
            </div>
            <div class="input-group">
                <label>é£²æ°´é‡ (mL)</label>
                <input type="number" id="in-water">
            </div>
            <div class="input-group">
                <label>é«”é‡ç´€éŒ„ (kg)</label>
                <div style="display:flex; gap:5px;">
                    <input type="number" id="w-morning" placeholder="ç©ºè…¹">
                    <input type="number" id="w-night" placeholder="ç¡å‰">
                </div>
            </div>
            <div class="input-group">
                <label>èº«å½¢åœåº¦ (cm)</label>
                <div style="display:flex; gap:5px;">
                    <input type="number" id="size-waist" placeholder="è…°åœ">
                    <input type="number" id="size-leg" placeholder="è…¿åœ">
                </div>
            </div>
            <button class="btn" style="background:var(--blue); color:white;" onclick="saveData()">å„²å­˜ä»Šæ—¥æ•¸æ“š</button>
        </div>
    </div>

    <div id="profile" class="page">
        <div class="card">
            <h3>ğŸ‘¤ å€‹äººè³‡æ–™è¨­å®š</h3>
            <div class="input-group"><label>æ€§åˆ¥</label><select id="p-gen"><option value="F">å¥³</option><option value="M">ç”·</option></select></div>
            <div class="input-group"><label>å‡ºç”Ÿå¹´æœˆæ—¥</label><input type="date" id="p-bday"></div>
            <div class="input-group"><label>èº«é«˜ (cm)</label><input type="number" id="p-h"></div>
            <div class="input-group"><label>é«”é‡ (kg)</label><input type="number" id="p-w"></div>
            <button class="btn" style="background:var(--green); color:white;" onclick="saveProfile()">æ›´æ–°è³‡æ–™èˆ‡è¨ˆç®—ä»£è¬</button>
        </div>
        <div class="card" id="result-profile" style="display:none;">
            æ‚¨çš„åŸºç¤ä»£è¬ (BMR): <b id="val-bmr"></b> kcal<br>
            å»ºè­°é£²æ°´é‡: <b id="val-water"></b> mL
        </div>
    </div>

    <nav class="nav">
        <a href="#" class="nav-item active" onclick="go('home')">ğŸ <span>é¦–é </span></a>
        <a href="#" class="nav-item" onclick="go('record')">ğŸ“<span>ç´€éŒ„</span></a>
        <a href="#" class="nav-item" onclick="go('profile')">ğŸ‘¤<span>å€‹äºº</span></a>
    </nav>

    <script>
        let db = JSON.parse(localStorage.getItem('hd_db')) || {};
        let prof = JSON.parse(localStorage.getItem('hd_prof')) || {};
        let curDate = "";

        function go(p) {
            document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(ni => ni.classList.remove('active'));
            document.getElementById(p).classList.add('active');
            if(p==='home') updateHome();
            if(p==='record') renderCal();
        }

        function saveProfile() {
            prof = {
                gen: document.getElementById('p-gen').value,
                bday: document.getElementById('p-bday').value,
                h: Number(document.getElementById('p-h').value),
                w: Number(document.getElementById('p-w').value)
            };
            localStorage.setItem('hd_prof', JSON.stringify(prof));
            calcMetabolic();
            alert("è³‡æ–™å·²æ›´æ–°ï¼");
        }

        function calcMetabolic() {
            if(!prof.h) return;
            let age = new Date().getFullYear() - new Date(prof.bday).getFullYear();
            let bmr = (prof.gen === 'M') 
                ? (10 * prof.w + 6.25 * prof.h - 5 * age + 5)
                : (10 * prof.w + 6.25 * prof.h - 5 * age - 161);
            
            document.getElementById('result-profile').style.display = 'block';
            document.getElementById('val-bmr').innerText = Math.round(bmr);
            document.getElementById('val-water').innerText = Math.round(prof.w * 35);
            return bmr;
        }

        function renderCal() {
            const cal = document.getElementById('cal');
            cal.innerHTML = '';
            for(let i=1; i<=31; i++) {
                let d = `2026-01-${String(i).padStart(2,'0')}`;
                let has = db[d];
                let el = document.createElement('div');
                el.className = `day ${curDate===d?'selected':''}`;
                el.innerHTML = i;
                if(has) {
                    let dots = `<div class="status-dots">`;
                    if(has.food > 0) dots += `<div class="dot" style="background:red"></div>`;
                    if(has.water > 0) dots += `<div class="dot" style="background:blue"></div>`;
                    if(has.period) dots += `<div class="dot" style="background:pink"></div>`;
                    dots += `</div>`;
                    el.innerHTML += dots;
                }
                el.onclick = () => { curDate=d; document.getElementById('edit-zone').style.display='block'; document.getElementById('ed-title').innerText=d; loadDay(d); renderCal(); };
                cal.appendChild(el);
            }
        }

        function loadDay(d) {
            let data = db[d] || { food:0, water:0, wm:0, wn:0, wa:0, leg:0, period:false };
            document.getElementById('in-food').value = data.food || "";
            document.getElementById('in-water').value = data.water || "";
            document.getElementById('w-morning').value = data.wm || "";
            document.getElementById('w-night').value = data.wn || "";
            document.getElementById('size-waist').value = data.wa || "";
            document.getElementById('size-leg').value = data.leg || "";
            document.getElementById('is-period').checked = data.period || false;
        }

        function saveData() {
            db[curDate] = {
                food: Number(document.getElementById('in-food').value),
                water: Number(document.getElementById('in-water').value),
                wm: Number(document.getElementById('w-morning').value),
                wn: Number(document.getElementById('w-night').value),
                wa: Number(document.getElementById('size-waist').value),
                leg: Number(document.getElementById('size-leg').value),
                period: document.getElementById('is-period').checked
            };
            localStorage.setItem('hd_db', JSON.stringify(db));
            alert("å„²å­˜æˆåŠŸï¼");
            renderCal();
        }

        function addFood(val) {
            let cur = Number(document.getElementById('in-food').value);
            document.getElementById('in-food').value = cur + Number(val);
        }

        function updateHome() {
            let today = new Date().toISOString().split('T')[0];
            let data = db[today] || {food:0, water:0};
            let bmr = calcMetabolic() || 2000;
            
            document.getElementById('h-eat').innerText = data.food;
            document.getElementById('h-water').innerText = data.water;
            document.getElementById('rem-kcal').innerText = Math.round(bmr - data.food);
            
            if(data.food > bmr) document.getElementById('coach-msg').innerText = "âš ï¸ ç†±é‡å·²è¶…éåŸºç¤ä»£è¬ï¼å»ºè­°é¿é–‹ç”œé»èˆ‡ç‚¸ç‰©ã€‚";
            else if(data.food < bmr && data.food > 0) document.getElementById('coach-msg').innerText = "ğŸ’¡ å°šæœªé”åˆ°åŸºç¤ä»£è¬ï¼Œè«‹è£œå……å„ªè³ªè›‹ç™½è³ªã€‚";
            if(data.period) document.getElementById('coach-msg').innerText = "ğŸŒ¸ ç”Ÿç†æœŸè¾›è‹¦äº†ï¼Œå¤šå–æº«æ°´ï¼Œå¥½å¥½ä¼‘æ¯ã€‚";
        }
    </script>
</body>
</html>
